!function(){angular.module("visUtil",[]).service("visUtil",function(){var e={degToRad:function(e){return Math.PI*e/180},radToDeg:function(e){return e/Math.PI*180},getArcVectors:function(e,t){return{x1:Math.cos(this.degToRad(e)),y1:Math.sin(this.degToRad(e)),x2:Math.cos(this.degToRad(t)),y2:Math.sin(this.degToRad(t))}},massageValuationIntoMetroPie:function(e){var t=_(e).pluck("ClosingValue").reduce(function(e,t){return e+t});return _(e).groupBy("Type").map(function(e,r){var a="GeographicExposure";"Cash"===r&&(a="AccountType");var n=_(e).pluck("ClosingValue").reduce(sum)/t*100;return{label:r,value:n,subGroups:_(e).groupBy(a).map(function(e,r){return{label:r,value:_(e).pluck("ClosingValue").reduce(sum)/t*100}}).value()}}).value()},createPieChartVectors:function(e,t,r,a){var n=this;if(!_.every(e,_.isNumber)&&!_.every(e,function(e){return e>0}))throw new Error("createPieChartPathData only accepts an array of positive numbers as the data argument");if(t>360)throw new Error("totalDegrees argument can't be more than 360");void 0===r&&(r=0),void 0===t&&(t=360),void 0===a&&(a=!0);var i=_.reduce(e,function(e,t){return e+t}),u=this.createScale(0,i,0,t),o=r,s=_(e).map(function(e){var t=u(e),r=n.getArcVectors(o,o+t);return o+=t,r.largeArc=t>180?1:0,r}).value();return s},createOrdinalScale:function(e){var t=_.clone(e);if(!_.isArray(e))throw new Error("createOrdinalScale only takes array as argument");return function(r){if(_.isNumber(r)&&e.length>r)return e[r];var a=t.shift();return t.push(a),a}},createScale:function(e,t,r,a){if(!_.every([e,t,r,a],function(e){return _.isNumber(e)||_.isDate(e)}))throw new Error("scale only accepts numbers or dates");return e=e.valueOf(),t=t.valueOf(),r=r.valueOf(),a=a.valueOf(),a>r?function(n){return(n-e)/(t-e)*(a-r)+r}:r>a?function(n){return(n-e)/(t-e)*(a-r)+r}:void 0},nearest:function(e,t){return e/=t,e=Math.round(e)*t},normalizeData:function(e){return _.map(e,function(e,t){return!_.isObject(e)&&_.isNumber(e)?{x:t,y:e}:e})},isDataPoint:function(e){return void 0!==e.x&&void 0!==e.y},massagePerfNumbersIntoGraphData:function(){},assertGraphData:function(e){if(!_.isArray(e))throw new Error("data argument has to be array");if(_.every(e,_.isObject)&&!_.every(e,this.isDataPoint))throw new Error("All objects in data argument need to have x and y attributes");if(!_.every(e,_.isObject)&&!_.every(e,_.isNumber))throw new Error("If data array isn't an array of objects it must be an array of numbers")},assertDataArray:function(e){if(!_.isArray(e))throw new Error("tick data has to be array");if(!_.every(e,_.isNumber)&&!_.every(e,_.isDate))throw new Error("tick data has to be an array of dates, numbers or strings")},convertDataToSvgPaths:function(e,t,r,a){var n=_(e).pluck("data").flatten().pluck("x").value(),i=_(e).pluck("data").flatten().pluck("y").value(),u=_.max(i),o=_.min(i),s=_.max(n),c=_.min(n),l=this.createOrdinalScale(a),h=this.createScale(c,s,0,t),f=this.createScale(o,u,r,0),v=this;return _.map(e,function(e){return{label:e.label,path:v.convertDataToSvgPath(e.data,t,r,h,f),color:l()}})},convertDataToSvgPath:function(e,t,r,a,n){this.assertGraphData(e),e=this.normalizeData(e);var i=(e.length,_(e).map(function(e){return{x:a(e.x),y:n(e.y)}}));return"M "+_(i).map(function(e){return""+e.x+" "+e.y}).join(" L ")},getZeroDecimalCount:function(e){var t=""+e;return t.match(/0\.(?:0+)?/)[0].length-2},roundUpToStep:function(e,t){var r;return r=parseFloat(1>t?(Math.ceil(e/t)*t).toFixed(this.getZeroDecimalCount(t)+1):Math.ceil(e/t)*t)},timeSteps:[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],numberSteps:[1,2,5,10],roundTickInterval:function(e,t){var r,a=""+e;if("date"===t)return _(this.timeSteps).filter(function(t){return t>e}).min(function(t){var r=Math.abs(e-t);return r}).value();if(.1>e){var n=this.getZeroDecimalCount(e),i=a.substr(n+2);r=parseFloat(i.substr(0,1)+"."+i.substr(1));var u=100*n;return _(this.numberSteps).min(function(e){return Math.abs(e-r)}).value()/u}var o=a.match(/\d+/)[0].length,s=Math.pow(10,o-1);return r=e/s,_(this.numberSteps).map().min(function(e){return Math.abs(e-r)}).value()*s},createTickValues:function(e,t){this.assertDataArray(e);var r=_.max(e),a=_.min(e),n="number";_.isDate(r)&&(n="date");for(var i=this.roundTickInterval((r-a)/t,n),u=this.roundUpToStep(a,i),o=[u];r>u+i;)u+=i,o.push(u);return"date"===n&&(o=_.map(o,this.toDate)),o},toDate:function(e){return new Date(e)},createTickObjects:function(e,t,r,a,n){if(!_.isArray(e))throw new Error("data needs to be array");if(!_.isNumber(t)||isNaN(t)||0>t)throw new Error("size needs to be an absolute number");a=a||10,r=r||10;var i,u=this,o=_.max(e),s=_.min(e);i=n?this.createScale(s,o,t,0):this.createScale(s,o,0,t);var c=Math.floor(t/a);r>c&&(r=c);var l=this.createTickValues(e,r),h=_.map(l,function(e){var t=u.formatChartLabel(e);return{label:t,value:e,position:i(e)}});return h[0].value!==s&&h.unshift({label:"",value:s,position:i(s)}),h[h.length-1].value!==o&&h.push({label:"",value:o,position:i(o)}),h},formatChartLabel:function(e){return _.isNumber(e)?e:_.isDate(e)?e.toDateString():void 0}};return e})}();