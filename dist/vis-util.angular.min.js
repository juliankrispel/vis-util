!function(){angular.module("visUtil",[]).service("visUtil",function(){var t={degToRad:function(t){return Math.PI*t/180},radToDeg:function(t){return t/Math.PI*180},getArcVectors:function(t,e){return{x1:Math.cos(this.degToRad(t)),y1:Math.sin(this.degToRad(t)),x2:Math.cos(this.degToRad(e)),y2:Math.sin(this.degToRad(e))}},createPieChartVectors:function(t,e,r,a){var n=this;if(!_.every(t,_.isNumber)&&!_.every(t,function(t){return t>0}))throw new Error("createPieChartPathData only accepts an array of positive numbers as the data argument");if(e>360)throw new Error("totalDegrees argument can't be more than 360");void 0===r&&(r=0),void 0===e&&(e=360),void 0===a&&(a=!0);var i=_.reduce(t,function(t,e){return t+e}),o=this.createScale(0,i,0,e),u=r,s=_(t).map(function(t){var e=o(t),r=n.getArcVectors(u,u+e);return u+=e,r.largeArc=e>180?1:0,r}).value();return s},createOrdinalScale:function(t){var e=_.clone(t);if(!_.isArray(t))throw new Error("createOrdinalScale only takes array as argument");return function(r){if(_.isNumber(r)&&t.length>r)return t[r];var a=e.shift();return e.push(a),a}},createScale:function(t,e,r,a){if(!_.every([t,e,r,a],function(t){return _.isNumber(t)||_.isDate(t)}))throw new Error("scale only accepts numbers or dates");return t=t.valueOf(),e=e.valueOf(),r=r.valueOf(),a=a.valueOf(),a>r?function(n){return(n-t)/(e-t)*(a-r)+r}:r>a?function(n){return(n-t)/(e-t)*(a-r)+r}:void 0},nearest:function(t,e){return t/=e,t=Math.round(t)*e},normalizeData:function(t){return _.map(t,function(t,e){return!_.isObject(t)&&_.isNumber(t)?{x:e,y:t}:t})},isDataPoint:function(t){return void 0!==t.x&&void 0!==t.y},assertGraphData:function(t){if(!_.isArray(t))throw new Error("data argument has to be array");if(_.every(t,_.isObject)&&!_.every(t,this.isDataPoint))throw new Error("All objects in data argument need to have x and y attributes");if(!_.every(t,_.isObject)&&!_.every(t,_.isNumber))throw new Error("If data array isn't an array of objects it must be an array of numbers")},assertDataArray:function(t){if(!_.isArray(t))throw new Error("tick data has to be array");if(!_.every(t,_.isNumber)&&!_.every(t,_.isDate))throw new Error("tick data has to be an array of dates, numbers or strings")},convertDataToSvgPaths:function(t,e,r,a){var n=_(t).pluck("data").flatten().pluck("x").value(),i=_(t).pluck("data").flatten().pluck("y").value(),o=_.max(i),u=_.min(i),s=_.max(n),c=_.min(n),h=this.createOrdinalScale(a),l=this.createScale(c,s,0,e),f=this.createScale(u,o,r,0),v=this;return _.map(t,function(t){return{label:t.label,path:v.convertDataToSvgPath(t.data,e,r,l,f),color:h()}})},convertDataToSvgPath:function(t,e,r,a,n){this.assertGraphData(t),t=this.normalizeData(t);var i=(t.length,_(t).map(function(t){return{x:a(t.x),y:n(t.y)}}));return"M "+_(i).map(function(t){return""+t.x+" "+t.y}).join(" L ")},getZeroDecimalCount:function(t){var e=""+t;return e.match(/0\.(?:0+)?/)[0].length-2},roundUpToStep:function(t,e){var r;return r=parseFloat(1>e?(Math.ceil(t/e)*e).toFixed(this.getZeroDecimalCount(e)+1):Math.ceil(t/e)*e)},timeSteps:[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],numberSteps:[1,2,5,10],roundTickInterval:function(t,e){var r,a=""+t;if("date"===e)return _(this.timeSteps).filter(function(e){return e>t}).min(function(e){var r=Math.abs(t-e);return r}).value();if(.1>t){var n=this.getZeroDecimalCount(t),i=a.substr(n+2);r=parseFloat(i.substr(0,1)+"."+i.substr(1));var o=100*n;return _(this.numberSteps).min(function(t){return Math.abs(t-r)}).value()/o}var u=a.match(/\d+/)[0].length,s=Math.pow(10,u-1);return r=t/s,_(this.numberSteps).map().min(function(t){return Math.abs(t-r)}).value()*s},createTickValues:function(t,e){this.assertDataArray(t);var r=_.max(t),a=_.min(t),n="number";_.isDate(r)&&(n="date");for(var i=this.roundTickInterval((r-a)/e,n),o=this.roundUpToStep(a,i),u=[o];r>o+i;)o+=i,u.push(o);return"date"===n&&(u=_.map(u,this.toDate)),u},toDate:function(t){return new Date(t)},createTickObjects:function(t,e,r,a,n){if(!_.isArray(t))throw new Error("data needs to be array");if(!_.isNumber(e)||isNaN(e)||0>e)throw new Error("size needs to be an absolute number");a=a||10,r=r||10;var i,o=this,u=_.max(t),s=_.min(t);i=n?this.createScale(s,u,e,0):this.createScale(s,u,0,e);var c=Math.floor(e/a);r>c&&(r=c);var h=this.createTickValues(t,r),l=_.map(h,function(t){var e=o.formatChartLabel(t);return{label:e,value:t,position:i(t)}});return l[0].value!==s&&l.unshift({label:"",value:s,position:i(s)}),l[l.length-1].value!==u&&l.push({label:"",value:u,position:i(u)}),l},formatChartLabel:function(t){return _.isNumber(t)?t:_.isDate(t)?t.toDateString():void 0}};return t})}();